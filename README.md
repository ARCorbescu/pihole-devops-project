# Pi-hole DevOps Project

This project automates the deployment of a Pi-hole DNS server on AWS using Terraform for verification and Ansible for configuration.

## 1. Project Structure
```
.
├── terraform/              # Infrastructure
│   ├── main.tf
│   ├── inventory.tf        # Generates Ansible Inventory
│   └── pihole_key          # SSH Key
├── ansible/                # Configuration Management
│   ├── playbook.yml        # Main Playbook
│   ├── inventory.ini       # Auto-generated by Terraform
│   └── roles/
│       ├── common/         # Docker & System Setup
│       └── pihole/         # Pi-hole Deployment & Config
```

## 2. Deployment Guide

### Step 1: Provision Infrastructure
```bash
cd terraform
terraform init
terraform apply
```
*This will automatically generate `../ansible/inventory.ini` with the correct IP.*

### Step 2: Configure Server (Ansible)
```bash
cd ../ansible
# The inventory file is auto-created, so just run:
ansible-playbook -i inventory.ini playbook.yml
```

### 3. Secret Management (Ansible Vault)
Sensitive data (like the Pi-hole password) is stored in `ansible/vault.yml`.
To encrypt the file:
```bash
ansible-vault encrypt ansible/vault.yml
# Enter a strong password
```
To run the playbook with encrypted secrets:
```bash
ansible-playbook -i inventory.ini playbook.yml --ask-vault-pass
```

## 4. Optimizations & Features
-   **Dynamic Inventory**: Terraform writes the `inventory.ini` file for you.
-   **Ansible Roles**: Logic is split into `common` (System) and `pihole` (App) for better modularity.
-   **Optimized Deployment**: Docker images are pulled *before* disabling system DNS, eliminating connection errors.
-   **Security**: Restricted ingress via AWS Security Groups.

## 5. Documentation
For detailed instructions, please refer to the `docs/` directory:
-   [Installation Guide](docs/INSTALLATION.md)
-   [Usage & Webhooks](docs/USAGE.md)
-   [Project Architecture](docs/project_documentation.md)
-   [Command Cheat Sheet](docs/cheat_sheet.md)
